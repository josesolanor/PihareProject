@model WebPihare.Models.AddVisitState

@{
    ViewData["Title"] = "Index";
}

<style>
    .chat {
        list-style: none;
        margin: 0;
        padding: 0;
    }

        .chat li {
            margin-bottom: 10px;
            padding-bottom: 5px;
            border-bottom: 1px dotted #B3A9A9;
        }

            .chat li .chat-body p {
                margin: 0;
                color: #777777;
            }

        .panel .slidedown .glyphicon, .chat .glyphicon {
            margin-right: 5px;
        }

    .panel-body {
        overflow-y: scroll;
        height: 250px;
    }

    ::-webkit-scrollbar-track {
        -webkit-box-shadow: inset 0 0 6px rgba(0,0,0,0.3);
        background-color: #F5F5F5;
    }

    ::-webkit-scrollbar {
        width: 12px;
        background-color: #F5F5F5;
    }

    ::-webkit-scrollbar-thumb {
        -webkit-box-shadow: inset 0 0 6px rgba(0,0,0,.3);
        background-color: #555;
    }
</style>

<h2>Index</h2>
<h2>@TempData["ErrorMsg"]</h2>
<p>
    <a asp-action="Create">Create New</a>
</p>

<div class="demo-container">
    <div id="gridContainer"></div>
</div>

<div id="StateModal" class="modal fade" role="dialog">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal">&times;</button>
                <h4 class="modal-title">Estado de la visita</h4>
            </div>
            <div class="modal-body">
                <div class="row">
                    <div class="col-md-12">
                        <form asp-action="AddState" method="post">
                            <div class="col-xs-12">
                                <div class="form-group">
                                    <label asp-for="stateId" class="control-label">Seleccionar un estado</label>
                                    <select asp-for="stateId" class="form-control" asp-items="ViewBag.VisitStateId"></select>
                                </div>
                            </div>
                            <div class="col-xs-12">
                                <div class="form-group">
                                    <input type="submit" value="Guardar" class="btn btn-default" />
                                </div>
                            </div>
                            <input asp-for="visitSeletedId" hidden value="0">
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<div id="ChatModal" class="modal fade" role="dialog">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal">&times;</button>
                <h4 class="modal-title">Observaciones</h4>
            </div>
            <div class="panel-body">
                <ul class="chat">
                    <li class="left clearfix">
                        <div class="chat-body clearfix">
                            <div class="header">
                                <strong class="primary-font">Jack Sparrow</strong> <small class="pull-right text-muted">
                                    <span class="glyphicon glyphicon-time"></span>14 mins ago
                                </small>
                            </div>
                            <p>
                                Lorem ipsum dolor sit amet, consectetur adipiscing elit. Curabitur bibendum ornare
                                dolor, quis ullamcorper ligula sodales.
                            </p>
                        </div>
                    </li>
                </ul>
            </div>
            <div class="panel-footer">
                <div class="input-group">
                    <form asp-action="AddChatMessage" method="post">
                        <div class="col-xs-12">
                            <div class="form-group">
                                <label asp-for="stateId" class="control-label">Seleccionar un estado</label>
                                <select asp-for="stateId" class="form-control" asp-items="ViewBag.VisitStateId"></select>
                            </div>
                        </div>
                        <div class="col-xs-12">
                            <div class="form-group">
                                <input type="submit" value="Enviar" class="btn btn-default" />
                            </div>
                        </div>
                        <input asp-for="visitSeletedId" hidden value="0">
                    </form>
                    <input id="btn-input" type="text" class="form-control input-sm" placeholder="Escribe tu mensaje aqui..." />
                    <span class="input-group-btn">
                        <button class="btn btn-warning btn-sm" id="btn-chat">
                            Enviar
                        </button>
                    </span>
                </div>
            </div>
        </div>
    </div>

    @*<div class="modal-header">
            <button type="button" class="close" data-dismiss="modal">&times;</button>
            <h4 class="modal-title">Observaciones</h4>
        </div>
        <div class="modal-body">
            <div class="row">
                <div class="row">
                    <div class="col-md-12">
                        <form asp-action="AddChatMessage" method="post">
                            <div class="col-xs-12">
                                <div class="form-group">
                                    <label asp-for="stateId" class="control-label">Seleccionar un estado</label>
                                    <select asp-for="stateId" class="form-control" asp-items="ViewBag.VisitStateId"></select>
                                </div>
                            </div>
                            <div class="col-xs-12">
                                <div class="form-group">
                                    <input type="submit" value="Enviar" class="btn btn-default" />
                                </div>
                            </div>
                            <input asp-for="visitSeletedId" hidden value="0">
                        </form>
                    </div>
                </div>
            </div>
        </div>*@

</div>
<script>
    $.ajax({
        url: '@Url.Action("LoadGrid", "Visitregistrations")',
        type: "GET"
    }).done(function (response) {

        var datasource = JSON.parse(response);

        $(function(){
            $("#gridContainer").dxDataGrid({
                dataSource: datasource,
                allowColumnReordering: true,
                allowColumnResizing: true,
                columnAutoWidth: true,
                showColumnLines: true,
                showRowLines: true,
                rowAlternationEnabled: true,
                showBorders: true,
                columnChooser: {
                enabled: true
                },
                filterRow: {
                    visible: true,
                },
                headerFilter: { visible: true },
                paging: {
                    pageSize: 10
                },
                pager: {
                    showPageSizeSelector: true,
                    allowedPageSizes: [10, 25, 50, 100]
                },
                selection: {
                    mode: "single"
                },
                grouping: {
                    autoExpandAll: true
                },
                headerFilter: {
                    visible: true
                },
                groupPanel: {
                    visible: true
                },
                "export": {
                    enabled: true,
                    fileName: "RegistroVisitas"+Date.now(),
                    allowExportSelectedData: true
                },
                columns: [
                    {
                        dataField: "VisitRegistrationId",
                        visible: false
                    },
                    {
                        dataField: "ClientId",
                        visible: false
                    },
                    {
                        dataField: "DepartmentId",
                        visible: false
                    },
                    {
                        dataField: "CommisionerId",
                        visible: false
                    },

                    {
                        dataField: "VisitDay",
                        caption: 'Fecha Visita',
                        dataType: "datetime",
                        format: 'dd/MM/yyyy HH:MM:ss'
                    },
                    {
                        dataField: "DepartmentCode",
                        caption: 'Codigo Departamento'
                    },
                    {
                        dataField: "FullNameClient",
                        caption: 'Nombre Cliente'
                    },
                    {
                        dataField: "FullNameCommisioner",
                        caption: 'Nombre Comisionista'
                    },
                    {
                        dataField: "State",
                        caption: 'Estado'
                    },
                    {
                        dataField: "Acciones",
                        caption: 'Acciones',
                        cellTemplate: function (container, options) {
                            var wrapper = $("<center>");
                            var ChatContainer = $("<div>");
                            var StateContainer = $("<div>");
                            var DetailsContainer = $("<div>");
                            var EditContainer = $("<div>");
                            var DeleteContainer = $("<div>");

                            container.append(wrapper.append(ChatContainer));

                            ChatContainer.dxButton({
                                hint: 'Observaciones',
                                type: "default",
                                icon: 'glyphicon glyphicon-comment',
                                width: 50,
                                onClick: function () {

                                    chatModal(options.data.VisitRegistrationId)
                                }
                            });

                            container.append(wrapper.append(StateContainer));

                            StateContainer.dxButton({
                                hint: 'Cambiar Estado',
                                type: "success",
                                icon: 'glyphicon glyphicon-cog',
                                width: 50,
                                onClick: function () {

                                    stateModal(options.data.VisitRegistrationId)
                                }
                            });

                            container.append(wrapper.append(DetailsContainer));

                            DetailsContainer.dxButton({
                                hint: 'Detalles',
                                type: "default",
                                icon: 'glyphicon glyphicon-list',
                                width: 50,
                                onClick: function () {
                                    var url = "@Url.Action("Details","VisitRegistrations")/" + options.data.VisitRegistrationId;
                                    window.location.href = url;
                                }
                            });

                            container.append(wrapper.append(EditContainer));

                            EditContainer.dxButton({
                                hint: 'Editar',
                                type: 'default',
                                icon: 'glyphicon glyphicon-pencil',
                                width: 50,
                                onClick: function () {
                                    var url = "@Url.Action("Edit","VisitRegistrations")/" + options.data.VisitRegistrationId;
                                    window.location.href = url;
                                }
                            });

                            container.append(wrapper.append(DeleteContainer));

                            DeleteContainer.dxButton({
                                hint: 'Editar',
                                type: 'danger',
                                icon: 'glyphicon glyphicon-trash',
                                width: 50,
                                onClick: function () {
                                    var url = "@Url.Action("Delete","VisitRegistrations")/" + options.data.VisitRegistrationId;
                                    window.location.href = url;
                                }
                            });

                        }
                    }
                ]
            });
        });

    });
</script>

<script>

    function stateModal(data) {
        $("#StateModal").modal();
        $("#visitSeletedId").val(data);
    }

    function chatModal(data) {
        $("#ChatModal").modal();
        $("#visitSeletedId").val(data);
    }

</script>
